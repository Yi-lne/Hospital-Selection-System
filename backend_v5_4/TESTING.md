# 后端功能测试文件

## 测试概览

本项目为后端Hospital Selection System添加了完整的功能测试套件。

## 测试文件列表

### 服务层测试 (Service Tests)

1. **UserServiceTest.java** - 用户服务测试
   - 测试用户注册、登录
   - 测试用户信息获取、更新
   - 测试密码修改、重置
   - 测试用户列表查询、状态管理
   - 测试头像上传

2. **HospitalServiceTest.java** - 医院服务测试
   - 测试医院列表查询
   - 测试医院多条件筛选
   - 测试医院详情获取
   - 测试医院科室、医生列表
   - 测试医院搜索建议
   - 测试按城市、等级查询医院

3. **DoctorServiceTest.java** - 医生服务测试
   - 测试医生列表查询
   - 测试医生筛选
   - 测试医生详情获取
   - 测试按科室、医院查询医生
   - 测试按职称查询医生
   - 测试医生搜索

4. **CommunityServiceTest.java** - 社区服务测试
   - 测试话题列表查询
   - 测试按板块查询话题
   - 测试话题详情获取
   - 测试话题发布、修改、删除
   - 测试评论发表、删除
   - 测试点赞/取消点赞（话题、评论）
   - 测试我的话题、我的评论查询
   - 测试浏览量增加

5. **DiseaseServiceTest.java** - 疾病分类服务测试
   - 测试疾病分类树获取
   - 测试一级、二级分类查询
   - 测试根据编码查询疾病
   - 测试疾病搜索
   - 测试疾病路径获取

6. **AreaServiceTest.java** - 地区服务测试
   - 测试省市区树获取
   - 测试省份、城市、区县列表查询
   - 测试根据编码查询地区
   - 测试地区搜索
   - 测试地区路径获取

7. **DepartmentServiceTest.java** - 科室服务测试
   - 测试医院科室列表查询
   - 测试科室详情获取
   - 测试科室搜索
   - 测试所有科室类型获取

8. **MessageServiceTest.java** - 私信服务测试
   - 测试发送私信
   - 测试会话列表获取
   - 测试消息历史获取
   - 测试标记已读、批量标记已读
   - 测试未读消息数量
   - 测试删除消息、清空聊天记录
   - 测试最近消息获取

9. **CollectionServiceTest.java** - 收藏服务测试
   - 测试添加收藏、取消收藏
   - 测试收藏列表获取（医院、医生、话题）
   - 测试检查是否已收藏
   - 测试收藏数量统计
   - 测试切换收藏状态

10. **MedicalHistoryServiceTest.java** - 病史服务测试
    - 测试添加病史
    - 测试病史列表查询
    - 测试病史详情获取
    - 测试病史修改、删除

11. **QueryHistoryServiceTest.java** - 查询历史服务测试
    - 测试记录查询
    - 测试查询历史列表获取
    - 测试按类型筛选查询历史
    - 测试删除查询历史、清空历史
    - 测试热门查询获取
    - 测试查询统计

### 控制器层测试 (Controller Tests)

1. **UserControllerTest.java** - 用户控制器测试
   - 测试用户注册接口
   - 测试用户登录接口
   - 测试用户登出接口
   - 测试获取用户信息接口
   - 测试更新用户信息接口
   - 测试修改密码接口

2. **HospitalControllerTest.java** - 医院控制器测试
   - 测试医院列表接口
   - 测试医院筛选接口
   - 测试医院详情接口
   - 测试医院科室列表接口
   - 测试医院医生列表接口
   - 测试医院搜索建议接口

3. **CommunityControllerTest.java** - 社区控制器测试
   - 测试话题列表接口
   - 测试按板块查询话题接口
   - 测试话题详情接口
   - 测试发布话题接口
   - 测试修改话题接口
   - 测试删除话题接口
   - 测试发表评论接口
   - 测试点赞/取消点赞接口
   - 测试我的话题接口
   - 测试板块列表接口

## 测试配置文件

1. **application-test.yml** - 测试环境配置
   - 使用H2内存数据库
   - 测试专用的JWT配置
   - 简化的日志配置

2. **TestBase.java** - 测试基类
   - 提供测试用的公共配置和工具方法
   - 包含测试用的常量定义
   - 提供JWT Token生成方法

## 运行测试

### 运行所有测试
```bash
cd backend
mvn test
```

### 运行特定测试类
```bash
mvn test -Dtest=UserServiceTest
```

### 运行特定测试方法
```bash
mvn test -Dtest=UserServiceTest#testRegister_Success
```

## 测试覆盖率

本测试套件覆盖了以下功能模块：

| 模块 | 测试类数 | 测试方法数 |
|------|---------|-----------|
| 用户模块 | 2 | 20+ |
| 医院模块 | 2 | 15+ |
| 医生模块 | 2 | 12+ |
| 社区模块 | 2 | 18+ |
| 疾病分类 | 1 | 6+ |
| 地区模块 | 1 | 7+ |
| 科室模块 | 1 | 5+ |
| 私信模块 | 1 | 10+ |
| 收藏模块 | 1 | 9+ |
| 病史模块 | 1 | 6+ |
| 查询历史 | 1 | 8+ |
| **总计** | **16** | **120+** |

## 测试技术栈

- **JUnit 5** - 测试框架
- **Mockito** - Mock框架
- **Spring Boot Test** - Spring集成测试
- **MockMvc** - MVC测试
- **H2 Database** - 内存数据库（可选）

## 注意事项

1. 测试使用Mock对象，不需要实际数据库连接
2. Controller测试需要完整的Spring上下文
3. 测试数据使用预定义的常量值
4. 所有测试遵循 AAA 模式（Arrange-Act-Assert）
