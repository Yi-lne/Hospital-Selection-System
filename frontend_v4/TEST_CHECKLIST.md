# 前端测试任务清单

## 当前进度

### ✅ 已完成

- [x] 创建测试配置文件（vitest.config.ts）
- [x] 创建测试环境设置（tests/setup.ts）
- [x] 创建测试工具函数（tests/utils/test-utils.ts）
- [x] 更新package.json添加测试依赖和脚本
- [x] 创建用户API测试（user.test.ts）- 12个测试用例
- [x] 创建医院API测试（hospital.test.ts）- 15个测试用例
- [x] 创建社区API测试（community.test.ts）- 18个测试用例
- [x] 创建登录组件测试（LoginForm.test.ts）- 10个测试用例
- [x] 创建测试文档（tests/README.md）
- [x] 创建测试执行指南（TESTING_GUIDE.md）

### 📝 进行中

- [ ] 运行测试并修复发现的问题

### ⏳ 待完成

#### API测试模块（剩余8个）

- [ ] 医生API测试（doctor.test.ts）
  - [ ] 医生列表（分页）
  - [ ] 医生详情
  - [ ] 医生筛选
  - [ ] 按医院查询医生
  - [ ] 按科室查询医生

- [ ] 私信API测试（message.test.ts）
  - [ ] 会话列表
  - [ ] 消息历史
  - [ ] 发送私信
  - [ ] 标记已读
  - [ ] 未读消息数
  - [ ] 批量标记已读

- [ ] 收藏API测试（collection.test.ts）
  - [ ] 添加收藏（医院/医生/话题）
  - [ ] 取消收藏
  - [ ] 收藏列表
  - [ ] 检查是否已收藏
  - [ ] 收藏数量统计

- [ ] 病史API测试（medical-history.test.ts）
  - [ ] 病史列表
  - [ ] 添加病史
  - [ ] 修改病史
  - [ ] 删除病史
  - [ ] 病史详情

- [ ] 查询历史API测试（query-history.test.ts）
  - [ ] 查询历史列表
  - [ ] 记录查询
  - [ ] 删除历史记录
  - [ ] 清空历史

- [ ] 地区API测试（area.test.ts）
  - [ ] 省市区树
  - [ ] 省份列表
  - [ ] 城市列表
  - [ ] 区县列表

- [ ] 疾病API测试（disease.test.ts）
  - [ ] 疾病分类树
  - [ ] 一级分类列表
  - [ ] 二级分类列表

- [ ] 科室API测试（department.test.ts）
  - [ ] 医院科室列表
  - [ ] 科室详情

#### 组件测试模块

- [ ] 用户组件
  - [ ] 注册表单（RegisterForm.test.ts）
  - [ ] 用户头像（UserAvatar.test.ts）
  - [ ] 个人资料表单（ProfileForm.test.ts）

- [ ] 医院组件
  - [ ] 医院卡片（HospitalCard.test.ts）
  - [ ] 医院筛选器（HospitalFilter.test.ts）
  - [ ] 医院详情页（HospitalDetail.test.ts）

- [ ] 医生组件
  - [ ] 医生卡片（DoctorCard.test.ts）
  - [ ] 医生筛选器（DoctorFilter.test.ts）
  - [ ] 医生详情页（DoctorDetail.test.ts）

- [ ] 社区组件
  - [ ] 话题卡片（TopicCard.test.ts）
  - [ ] 话题列表（TopicList.test.ts）
  - [ ] 话题详情（TopicDetail.test.ts）
  - [ ] 发布话题（PublishTopic.test.ts）
  - [ ] 评论列表（CommentList.test.ts）
  - [ ] 评论项（CommentItem.test.ts）
  - [ ] 点赞按钮（LikeButton.test.ts）

- [ ] 通用组件
  - [ ] 分页组件（Pagination.test.ts）
  - [ ] 加载组件（Loading.test.ts）
  - [ ] 空状态组件（Empty.test.ts）

## 测试用例统计

### 当前已完成测试用例

| 模块 | 测试文件 | 测试用例数 | 状态 |
|------|---------|-----------|------|
| 用户API | user.test.ts | 12 | ✅ |
| 医院API | hospital.test.ts | 15 | ✅ |
| 社区API | community.test.ts | 18 | ✅ |
| 登录组件 | LoginForm.test.ts | 10 | ✅ |
| **总计** | **4个文件** | **55个用例** | **✅** |

### 预计总测试用例数

| 类别 | 文件数 | 用例数 |
|------|--------|--------|
| API测试 | 12个文件 | ~180个用例 |
| 组件测试 | 20个文件 | ~120个用例 |
| **总计** | **32个文件** | **~300个用例** |

**当前完成度**: 55/300 = **18.3%**

## 测试覆盖功能清单

### 功能模块覆盖率

#### 1. 用户认证模块（预计40个用例，已完成12个）

- [x] 用户注册（成功/失败）
- [x] 用户登录（成功/失败）
- [x] 获取用户信息
- [x] 更新用户信息
- [x] 修改密码
- [x] 用户登出
- [ ] 自动登录（Token验证）
- [ ] 找回密码
- [ ] 上传头像

#### 2. 医院查询模块（预计35个用例，已完成15个）

- [x] 医院列表（分页）
- [x] 医院详情
- [x] 医院筛选（城市/等级/医保/科室）
- [x] 医院搜索
- [x] 医院科室列表
- [x] 医院医生列表
- [ ] 医院对比
- [ ] 医院收藏（集成测试）

#### 3. 医生查询模块（预计25个用例，已完成0个）

- [ ] 医生列表（分页）
- [ ] 医生详情
- [ ] 医生筛选
- [ ] 医生搜索
- [ ] 按医院查询医生
- [ ] 按科室查询医生

#### 4. 社区交流模块（预计50个用例，已完成18个）

- [x] 话题列表（分页）
- [x] 话题详情
- [x] 发布话题
- [x] 话题评论
- [x] 评论列表
- [x] 点赞/取消点赞
- [x] 我的话题
- [x] 板块列表
- [ ] 编辑话题
- [ ] 删除话题
- [ ] 回复评论
- [ ] 收藏话题

#### 5. 用户中心模块（预计40个用例，已完成0个）

- [ ] 个人资料查看
- [ ] 个人资料编辑
- [ ] 病史管理（增删改查）
- [ ] 收藏列表
- [ ] 取消收藏
- [ ] 查询历史
- [ ] 清空历史

#### 6. 私信模块（预计30个用例，已完成0个）

- [ ] 会话列表
- [ ] 消息历史
- [ ] 发送私信
- [ ] 标记已读
- [ ] 未读消息数
- [ ] 批量标记已读
- [ ] 删除消息

#### 7. 基础数据模块（预计20个用例，已完成0个）

- [ ] 省市区数据（树/省/市/区）
- [ ] 疾病分类（树/一级/二级）
- [ ] 科室数据

#### 8. 通用功能（预计60个用例，已完成10个）

- [x] 表单验证（登录）
- [ ] 表单验证（注册）
- [ ] 表单验证（发布话题）
- [ ] 分页功能
- [ ] 搜索功能
- [ ] 筛选功能
- [ ] 排序功能
- [ ] 加载状态
- [ ] 错误处理
- [ ] 权限控制（路由守卫）

## 下一步执行计划

### 第一阶段：完成所有API测试（优先级：P0）

**目标**：完成剩余8个API模块的测试

**预计工作量**：2-3小时

**执行步骤**：
1. 创建doctor.test.ts（30分钟）
2. 创建message.test.ts（30分钟）
3. 创建collection.test.ts（20分钟）
4. 创建medical-history.test.ts（20分钟）
5. 创建query-history.test.ts（15分钟）
6. 创建area.test.ts（15分钟）
7. 创建disease.test.ts（15分钟）
8. 创建department.test.ts（10分钟）

### 第二阶段：运行测试并修复问题（优先级：P0）

**目标**：确保所有API测试通过

**预计工作量**：1-2小时

**执行步骤**：
1. 运行所有API测试：`npm run test:run`
2. 记录失败的测试用例
3. 分析失败原因
4. 修复前端代码
5. 重新运行测试
6. 重复直到所有测试通过

### 第三阶段：完成核心组件测试（优先级：P1）

**目标**：完成核心组件的测试

**预计工作量**：3-4小时

**执行步骤**：
1. 用户组件（注册表单、用户头像）- 1小时
2. 医院组件（卡片、筛选器、详情页）- 1小时
3. 社区组件（话题卡片、评论列表）- 1小时
4. 通用组件（分页、加载、空状态）- 1小时

### 第四阶段：达到测试覆盖率目标（优先级：P1）

**目标**：整体测试覆盖率达到80%

**预计工作量**：1-2小时

**执行步骤**：
1. 生成覆盖率报告：`npm run test:coverage`
2. 分析未覆盖的代码
3. 补充测试用例
4. 重新生成报告
5. 重复直到达到目标

## 快速启动测试

```bash
# 1. 进入前端目录
cd frontend

# 2. 安装依赖
npm install

# 3. 运行测试
npm run test:run

# 4. 查看覆盖率
npm run test:coverage
```

## 问题记录模板

在测试过程中发现问题时，使用以下模板记录：

```
### 问题 #[序号]: [简短描述]

**发现时间**: 2026-02-01 14:30
**测试文件**: tests/api/user.test.ts
**测试用例**: 应该成功登录

**问题描述**:
登录API返回的数据格式与预期不符

**错误信息**:
```
Expected: { code: 200, data: { token: string, userInfo: {...} } }
Received: { code: 200, data: { user: {...} } }
```

**分析**:
后端返回的字段是 `user` 而不是 `userInfo`

**解决方案**:
[ ] 修改前端类型定义 UserLoginResponse
[ ] 修改登录处理逻辑
[ ] 需要询问用户：是否修改后端返回字段名？

**状态**: 📝 待处理 / 🔍 修复中 / ✅ 已完成

**修复记录**:
- 2026-02-01 15:00: 修改了类型定义，测试通过
```

## 测试里程碑

- [ ] **里程碑1**: 完成所有API测试（12个文件，~180个用例）
- [ ] **里程碑2**: 所有API测试通过（100%通过率）
- [ ] **里程碑3**: 完成核心组件测试（20个组件，~100个用例）
- [ ] **里程碑4**: 测试覆盖率达到80%
- [ ] **里程碑5**: 集成到CI/CD流程

## 备注

- 所有测试文件都遵循命名规范：`*.test.ts`
- 测试文件与源文件对应存放于 `tests/` 目录
- 使用vitest作为测试运行器
- Mock所有外部依赖（API、Router、Store）
- 测试数据使用固定的mock数据，不依赖数据库实际数据
- 发现需要修改后端的问题时，必须先询问用户意见
